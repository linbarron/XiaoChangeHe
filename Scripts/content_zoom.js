jQuery.fn.fancyZoom = function (e) { function u(t) { if (n) return !1; n = !0; var r = $($(this).attr("href")), i = e.width, u = e.height, f = window.innerWidth || window.document.documentElement.clientWidth || window.document.body.clientWidth, l = window.innerHeight || window.document.documentElement.clientHeight || window.document.body.clientHeight, c = window.pageXOffset || window.document.documentElement.scrollLeft || window.document.body.scrollLeft, h = window.pageYOffset || window.document.documentElement.scrollTop || window.document.body.scrollTop, p = { width: f, height: l, x: c, y: h }, f = (i || r.width())-80, l = (u || r.height()) + 40, d = p, v = Math.max(d.height / 2 - l / 2 + h, 0), m = d.width / 2 - f / 2, g = t.pageY, y = t.pageX; return s.attr("curTop", g), s.attr("curLeft", y), s.attr("scaleImg", e.scaleImg ? "true" : "false"), $("#zoom").hide().css({ position: "absolute", top: g + "px", left: y + "px", width: "1px", height: "1px" }), s.hide(), e.closeOnClick && $("#zoom").click(a), e.scaleImg ? (o.html(r.html()), $("#zoom_content img").css("width", "100%")) : o.html(""), $("#zoom").animate({ top: v + "px", left: m + "px", opacity: "show", width: f, height: l }, 500, null, function () { e.scaleImg != 1 && o.html(r.html()), s.show(), n = !1 }), !1 } function a() { return n ? !1 : (n = !0, $("#zoom").unbind("click"), s.attr("scaleImg") != "true" && o.html(""), s.hide(), $("#zoom").animate({ top: s.attr("curTop") + "px", left: s.attr("curLeft") + "px", opacity: "hide", width: "1px", height: "1px" }, 500, null, function () { s.attr("scaleImg") == "true" && o.html(""), n = !1 }), !1) } var e = e || {}, t = e && e.directory ? e.directory : "images", n = !1; if ($("#zoom").length == 0) { var r = '<div class="round_shade_box" id="zoom"> <div class="round_shade_center" id="zoom_content"> </div>  </div>'; $("#BigImg").append(r), $("html").click(function (e) { $(e.target).parents("#zoom:visible").length == 0 && a() }), $(document).keyup(function (e) { e.keyCode == 27 && $("#zoom:visible").length > 0 && a() }), $("#zoom_close").click(a) } var i = $("#zoom"), s = $("#zoom_close"), o = $("#zoom_content"); return this.each(function (e) { $($(this).attr("href")).hide(), $(this).click(u) }), $("#zoom_close").click(a), this }