@using WitBird.XiaoChangHe.Models.Info
@model IEnumerable<ProductType>

@{
    Layout = null;
    int i = 1;
    int m = 1;
}

<!DOCTYPE html>

<html lang="en">
<head>
    <title>开始点菜</title>
    <script>document.cookie = 'resolution=' + Math.max(screen.width, screen.height) + '; path=/';</script>
    <meta charset="utf-8"  http-equiv="expires" content="800000" >
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <link href="~/NewContent/style/ksdc.css" rel="stylesheet" type="text/css">
    <script src="~/NewContent/js/jquery.js"></script>
    <script src="~/NewContent/js/ksdc.js"></script>
    <style>
        a {
            text-decoration: none;
            color: #fff;
        }
    </style>

</head>
<body>
    <div class="container">
        @if (ViewBag.FirstMenus != null)
        {
            <div class="left_top">今日特价</div>
            <div class="top_list">
                <ul>
                    @foreach (ProductType item1 in ViewBag.FirstMenus as List<ProductType>)
                    {
                        if (m == 1)
                        {
                        <li class="r_bor bg1" onclick=" DisplaySecondMenus('@item1.TypeId', '@item1.RestaurantId') ">@item1.TypeName</li>
                     }
                     else if (m == 2)
                     {
                        <li class="r_bor" onclick=" DisplaySecondMenus('@item1.TypeId', '@item1.RestaurantId') ">@item1.TypeName</li>
                     }
                     else
                     {
                        <li onclick=" DisplaySecondMenus('@item1.TypeId', '@item1.RestaurantId') ">@item1.TypeName</li>
                     }
                     m++;
                 }
                </ul>
            </div>
    }
        <div class="left_list" style="margin-top: 0px; clear: both;">
            <ol id="left_list">
                @if (Model != null)
                {

                    foreach (ProductType item in Model)
                    {
                        if (i == 1)
                        {
                    <li class="bg2" tid="@item.TypeId" rid="@item.RestaurantId" onclick=" DisplayContent('@item.TypeId', '@item.RestaurantId') ">
                        @Html.DisplayFor(modelItem => item.TypeName)
                        <span class="shu">@i</span>
                    </li>
                }
                else
                {
                    <li tid="@item.TypeId" rid="@item.RestaurantId" onclick=" DisplayContent('@item.TypeId', '@item.RestaurantId') ">
                        @Html.DisplayFor(modelItem => item.TypeName)
                        <span class="shu">@i</span>
                    </li>
                }
                i++;
            }
        }
            </ol>
        </div>

        <div class="content" id="foodcontent" style="top: 44px;">

        </div>

        <div class="footer">
            <div class="footer_left">
                <img src="/NewContent/images/4.png" onclick="myMenu()"><span class="shu2" id="totalcount">2</span><span class="money">|　45.00元</span></div>

            <a href="/NewUI/ydxx.html">
                <div class="footer_right">选好了</div>
            </a>
        </div>
    </div>
    <input  type="hidden" value="@(Session["CompanyId"] != null ? Session["CompanyId"].ToString() : "")"  id="CompanyId"/>
    <script>
        var orderid;
        var MemberCardNo;
        var SourceAccountId = '@ViewBag.SourceAccountId';
    var bookTime = '@ViewBag.BookTime'
        var Type = '@ViewBag.FastFood';
        var CompanyId = $("#CompanyId").val();
    </script>
    <script>
        $(document).ready(function () {
            loadContent();
        });
        function DisplaySecondMenus(TypeId, RestaurantId) {
            $.ajaxSetup({ async: false });
            $.post("/ProductType/getSecondProductTypeByTypeId", { RestaurantId: RestaurantId, TypeId: TypeId }, function (msg) {
                $("#left_list").html(msg);
            });
            loadContent();
        }
    </script>
    <script>
        function loadContent() {

            var TypeId = $("#left_list li:first").attr("tid");
            var RestaurantId = $("#left_list li:first").attr("rid");
            DisplayContent(TypeId, RestaurantId);
        }

        function DisplayContent(TypeId, RestaurantId) {
            $.ajaxSetup({ async: false });
            var Status = '@ViewBag.Status';
        $.post("/Product/getProductByProductTypeId", { RestaurantId: RestaurantId, ProductTypeId: TypeId, SourceAccountId: SourceAccountId, Status: Status, Type: Type }, function (msg) {

            $("#foodcontent").html(msg);
            orderid = $("#OrderId").val();
            MemberCardNo = $("#MemberCardNo").val();
            var t = $(".totalcount").val();
            //显示用户已点菜数量
            if (t != null || t != 0 || t != "" || t != undefined) {
                $("#totalcount").html(t);
            }

        });

    }


    </script>
<script>
    function myMenu() {
        $.ajaxSetup({ async: false });
        if (orderid == null || orderid == '') {

            alert("你还未点菜！");
            return;
        }
        window.location.href = "/MyMenu/MyMenu?MemberCardNo=" + MemberCardNo + "&OrderId=" + orderid + "&SourceAccountId=" + SourceAccountId + "&RstType=" + Type + "&ComypanyId =" + CompanyId + "";

    }


    function myOrder() {
        $.ajaxSetup({ async: false });
        if (orderid == null || orderid == '') {

            alert("你还未点菜！");
            return;
        }
        window.location.href = "/MyMenu/MyOrderDetail?MemberCardNo=" + MemberCardNo + "&OrderId=" + orderid + "&SourceAccountI=" + SourceAccountId + "&ComypanyId =" + CompanyId + "&RstType=" + Type + "";

    }

    function add(id) {
        var num = $("#" + id).val();
        $("#" + id).val(parseInt(num) + 1);
        $.ajaxSetup({ cache: false });
        var productId = id;
        var num1 = $("#" + id).val();
        if (num1 > 0) {
            $("#" + id).css("display", "inline");
            $("#" + "pic" + id).css("display", "inline");
        }
        //用户已点菜数量
        var total = $("#totalcount").html();
        if (total == null || total == "" || total == undefined) {
            total = 0;
        }

        $("#totalcount").html(parseInt(total) + 1);

        ////好多人点过此菜
        //if (num1 == 1) {
        //    var num = $("#DianCount" + id).html();

        //    $("#DianCount" + id).html(parseInt(num) + 1);
        //    var num2 = $("#DianCount" + id).html();
        //    $.post("/ProductConfigure/save", { id: id, Count: num2 }, function (msg1) {
        //    });
        //}
        var price = $("#rmb" + id).html(); //.replace('￥', '');
        if (orderid == null || orderid == '') {
            $.post("/Order/SaveOrders", { type: "Insert", SourceAccountId: SourceAccountId, bookTime: bookTime, isQuick: Type }, function(msg) {
                //$("#saveorderid").val(msg);
                orderid = msg;
                if (msg != "00000000-0000-0000-0000-000000000000") {


                    $.post("/Order/SaveOrderDetails", { type: "Insert", productId: productId, unitPrice: price, orderId: msg, productCount: num1 }, function(msg1) {
                        if (msg1 == 1) {

                        }

                    });
                }

            });
        } else {
            if (orderid != "00000000-0000-0000-0000-000000000000") {
                var num1 = $("#" + id).val();
                $.post("/Order/SaveOrderDetails", { type: "Insert", productId: productId, unitPrice: price, orderId: orderid, productCount: num1 }, function(msg1) {
                    if (msg1 == 1) {

                    }

                });
            }
        }
    }

    function jian(id) {
        var num = $("#" + id).val();
        if (num > 0) {
            $("#" + id).val(parseInt(num) - 1);
        }
        $.ajaxSetup({ cache: false });
        var num1 = $("#" + id).val();
        if (num1 == 0) {
            $("#" + id).css("display", "none");
            $("#" + "pic" + id).css("display", "none");
        }
        //用户已点菜数量
        var total = $("#totalcount").html();
        if (total > 0) {
            $("#totalcount").html(parseInt(total) - 1);
        }
        ////好多人点过此菜
        //if (num1 == 0) {
        //    var num = $("#DianCount" + id).html();
        //    if (num > 0) {
        //        $("#DianCount" + id).html(parseInt(num) - 1);
        //        var num2 = $("#DianCount" + id).html();
        //        $.post("/ProductConfigure/save", { id: id, Count: num2 }, function (msg1) {
        //        });
        //    }
        //}
        var productId = id;
        var price = $("#rmb" + id).html(); //.replace('￥', '');
        if (orderid != null && orderid != '') {
            if (orderid != "00000000-0000-0000-0000-000000000000") {

                if (num1 > 0) {
                    $.post("/Order/SaveOrderDetails", { type: "Insert", productId: productId, unitPrice: price, orderId: orderid, productCount: num1 }, function(msg1) {
                        if (msg1 == 1) {

                        }

                    });
                } else if (num1 == 0) {
                    var num1 = $("#" + id).val();
                    $.post("/Order/DelOrderDetails", { productId: productId, orderId: orderid }, function(msg1) {
                        if (msg1 == 1) {

                        } else {

                        }
                    });
                }
            }
        }

    }

    function addLove(id) {
        var num = $("#love" + id).html();
        $("#love" + id).html(parseInt(num) + 1);
        var num1 = $("#love" + id).html();
        $.post("/ProductConfigure/save", { id: id, LoveCount: num1 }, function(msg1) {

        });
    }


    function dialog(id) {
        var str = "<nav><img src=\"/Order/GetBigImages/" + id + "\" style=\"width: 85%;height: 100%;margin: 10px;-webkit-border-radius: 5px;border-radius: 5px;max-width: 300px; max-height: 300px;-webkit-border-radius: 5px;border-radius: 5px;\"/> </nav>";
        var unit = "%";
        sAlert(str, 90, 40, unit);
    }


    function sAlert(str, msgw, msgh, unit) {
        var msgw, msgh, bordercolor;
        msgw = msgw; //提示窗口的宽度
        msgh = msgh; //提示窗口的高度
        bordercolor = "#1da507"; //提示窗口的边框颜色
        titlecolor = "#1da507"; //提示窗口的标题颜色

        var sWidth, sHeight;
        sWidth = document.body.offsetWidth;
        sHeight = document.body.offsetHeight;

        var bgObj = document.createElement("div");
        bgObj.setAttribute('id', 'bgDiv');
        bgObj.style.position = "absolute";
        bgObj.style.top = "0";
        bgObj.style.background = "#777";
        bgObj.style.filter = "progid:DXImageTransform.Microsoft.Alpha(style=3,opacity=25,finishOpacity=75";
        bgObj.style.opacity = "0.6";
        bgObj.style.left = "0";
        bgObj.style.width = sWidth + "px";
        bgObj.style.height = sHeight + "px";
        document.body.appendChild(bgObj);
        var msgObj = document.createElement("div")
        msgObj.setAttribute("id", "msgDiv");
        msgObj.setAttribute("align", "center");
        msgObj.style.position = "absolute";
        //msgObj.style.background = "white";
        msgObj.style.font = "12px/1.6em Verdana, Geneva, Arial, Helvetica, sans-serif";
        //msgObj.style.border = "1px solid " + bordercolor;
        msgObj.style.width = msgw + unit;
        // msgObj.style.height = msgh + unit;
        msgObj.style.top = "25" + unit;
        msgObj.style.left = "5" + unit;
        msgObj.onclick = function() {
            document.body.removeChild(bgObj);

            document.body.removeChild(msgObj);
        }
        document.body.appendChild(msgObj);
        var txt = document.createElement("span");
        txt.style.margin = "1em 0"
        txt.setAttribute("id", "msgTxt");
        txt.innerHTML = str;
        document.getElementById("msgDiv").appendChild(txt);
        var strs = document.createElement("span");
        strs.style.margin = "1em 0"
        strs.setAttribute("id", "msgTxts");
        strs.innerHTML = "";
        document.getElementById("msgDiv").appendChild(strs);

    }


</script>

</body>
</html>


